<!DOCTYPE html>
<html xmlns="https://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>U.S Airlines On-Time Performance</title>
    <meta name="Resource-type" content="Document" />


    <link rel="stylesheet" type="text/css" href="jquery.fullPage.css" />
   <!--[if IE]>
    <script type="text/javascript">
        var console = { log: function() {} };
    </script>
    <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>

    <script type="text/javascript" src="jquery.fullPage.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            $('#wrapper').fullpage({
                sectionsColor: ['#ffffff', '#ffffff', '#f2f2f2', '#ffffff', '#f2f2f2', '#ffffff', '#f2f2f2'],
                navigation: true,
                navigationPosition: 'right',
                navigationTooltips: ['Intro', 'Overview', 'Airlines on Time Performance', 'Complaints', 'Religion', 'About', 'Resources'],
                anchors:['Intro', 'Overview', 'Airlines On Time Performance', 'Complaints', 'Religion', 'About', 'Author']
            });
        });
    </script>
    <style>
        #section0{
            background-image: url("imgs/airplane.jpeg");
            height: 100%;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;

        }
        div.tooltip {
            position: absolute;
            text-align: center;
            width: 100px;
            height: 50px;
            padding: 2px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }
    </style>

</head>
<body>


<div id="wrapper">
    <div class="section " id="section0">
        <h1>U.S. Airlines On-Time Performance</h1>
        <p>Data to help you decide which carrier to use for your next trip</p>
    </div>
    <div class="section" id="section1">
        <!--<div class="slide" id="slide1">-->
            <!--<div class="intro">-->
                <!--<h1>Around the world scrolling</h1>-->
                <!--<p>Go to the first section and scroll up or to the last one and scroll down to see how it works.</p>-->
            <!--</div>-->
        <!--</div>-->
        <!--<div class="slide active" id="slide2">-->
            <!--<h1>Slide 2</h1>-->
        <!--</div>-->
        <!--<div class="slide" id="slide3">-->
            <!--<h1>Slide 3</h1>-->
        <!--</div>-->
        <div class="container">
            <div class="row">
                <div class="col">
                    <h1>U.S Airlines on Time Performance</h1>
                </div>

            </div>
            <div class="row">
                <div class="col">

                </div>
                <div class="col-10" id="on-time-performance">

                    <div class="btn-group" role="group" aria-label="Month Selector">
                        <button type="button" class="btn btn-info" data-selection="Apr-17" onClick="changeSelection(this)">April</button>
                        <button type="button" class="btn btn-warning" data-selection="May-17" onClick="changeSelection(this)">May</button>
                        <button type="button" class="btn btn-warning" data-selection="Jun-17" onClick="changeSelection(this)">June</button>
                    </div>
                </div>
            </div>
        </div>


    </div>
    <div class="section" id="section2">
        <div class="intro">
            <h1>Scroll Down</h1>
            <p>And it will animate down to the first section</p>
        </div>
    </div>
    <div class="section" id="section3">
        <div class="container">
            <div class="row">
                <div class="col">
                    <h1> About this Visualization</h1>
                </div>

            </div>
            <div class="row">
                <div class="col">
                    <h3> Narrative Visualization Method</h3>
                    This project was created using the hybrid visualization structure of interactive slideshow.
                    Guidance is provided on each slide. Users can investigate further on each slide or continue to the following one.
                    <h3> Scenes</h3>
                    <h3> Annotations</h3>
                </div>

                <div class="col">
                    <h3> Parameters</h3>
                    In the on time performance graph the parameter is the month for which the data is displayed that can be selected by clicking on the buttons below the graph.
                    There is an intuitive side bar which allows users to navigate between the different slides. Each slide is represented by a circle. And there is a slightly bigger circle representing the current slide.
                    On hover on each circle there is a tooltip with the name of each slide. Users can navigate either scrolling up and down or by clicking on one of this circles.
                    <h3> Triggers </h3>
                    In the on time performance graph there is an on hover event that triggers a tooltip with the actual value of on time performance
                </div>
            </div>
        </div>
    </div>
    <div class="section" id="section4">
        <div class="container">
            <div class="row">
                <div class="col">
                    <h1> About the Author</h1>
                    This project was created by <a href="https://www.linkedin.com/in/indiragp/">Indira Gutierrez-Polo</a>
                </div>
                <div class="col">
                    <h1> Resources </h1>
                    <ul>
                        <li><a href="https://github.com/alvarotrigo/fullPage.js/">fullPage.js</a></li>
                        <li><a href="https://v4-alpha.getbootstrap.com/">Bootstrap.js</a></li>
                        <li><a href="https://www.transportation.gov/airconsumer/">Dataset</a></li>
                        <!--<li><a href=""></a></li>-->
                        <!--<li><a href=""></a></li>-->

                    </ul>
                </div>
            </div>
        </div>

    </div>
</div>
<script src="https://d3js.org/d3.v3.min.js"></script>

<script>

    var margin = {top: 20, right: 20, bottom: 150, left: 40},
        width = 800 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    // Parse the date / time
    var	parseDate = d3.time.format("%Y-%m").parse;

    var x = d3.scale.ordinal().rangeRoundBands([0, width], .05);

    var y = d3.scale.linear().range([height, 0]);

    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");
        //.tickFormat(d3.time.format("%Y-%m"));

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
        .ticks(10);

    var svg = d3.select("#on-time-performance").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("id", "barchart")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");
    var selectedDate = "Apr-17";
    var axisExist = false;
    bars(selectedDate);

    // Define the div for the tooltip
    var div = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    function changeSelection(theButton) {
        $('.btn-info').addClass('btn-warning');
        $('.btn-info').removeClass('btn-info');
        $(theButton).removeClass('btn-warning');
        $(theButton).addClass('btn-info');
        var selectedDate = theButton.dataset.selection;
        bars(selectedDate);
    }

    // Ref: http://bl.ocks.org/enjalot/1429426
    function bars(selectedDate){
        d3.csv("data.csv", function(error, data) {

            data = data.filter( function(row) {
                return row['Date'] == selectedDate;
            });
            data.forEach(function(d) {
                d.date = parseDate(d['Date']);
                d.value = +d.P_ONTIME * 100;//% ONTIME
            });


            x.domain(data.map(function(d) { return d['CARRIER']; }));
            y.domain([0, d3.max(data, function(d) { return d.value; })]);

            var vis = d3.select("#barchart");

            //a good written tutorial of d3 selections coming from protovis
            //http://www.jeromecukier.net/blog/2011/08/09/d3-adding-stuff-and-oh-understanding-selections/
            var bars = vis.selectAll("rect.bar")
                .data(data);

            //enter
            bars.enter()
                .append("svg:rect")
                .attr("class", "bar")
                .attr("fill", "#800");


            //exit
            bars.exit()
                .transition()
                .duration(300)
                .ease("exp")
                .attr("width", 0)
                .remove();


            bars
                .attr("stroke-width", 4)
                .transition()
                .duration(300)
                .ease("quad")
                .style("fill", "steelblue")
                .attr("x", function(d) { return x(d['CARRIER']); })
                .attr("width", x.rangeBand())
                .attr("y", function(d) { return y(d.value); })
                .attr("height", function(d) { return height - y(d.value); });

            if(axisExist) {
                bars.select(".x.axis") // change the x axis
                    .duration(750)
                    .call(xAxis);
                bars.select(".y.axis") // change the y axis
                    .duration(750)
                    .call(yAxis);
            } else {
                svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis)
                    .selectAll("text")
                    .style("text-anchor", "end")
                    .attr("dx", "-.8em")
                    .attr("dy", "-.55em")
                    .attr("transform", "rotate(-90)" );

                svg.append("g")
                    .attr("class", "y axis")
                    .call(yAxis)
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end");
//                    .text("Value ($)");
                axisExist = true;

            }

        bars.on("mouseover", function(d) {
                div.transition()
                    .duration(200)
                    .style("opacity", .9);
                div	.html( "On time percentage: <br>"+ d.value +"%")
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px");
            })
                .on("mouseout", function(d) {
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

        });


    }


</script>
</body>
</html>